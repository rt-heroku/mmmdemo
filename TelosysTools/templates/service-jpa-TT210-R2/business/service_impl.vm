/*
 * Created on $today.date ( Time $today.time )
 * Generated by $generator.name ( version $generator.version )
 */
package ${target.javaPackageFromFolder(${SRC})};

import java.util.ArrayList;
import java.util.LinkedList;
import java.util.List;
import java.util.Map;

import javax.annotation.Resource;

import ${ENTITY_PKG}.${entity.name};
import ${ENTITY_PKG}.jpa.${entity.name}Entity;
#if( $entity.hasCompositePrimaryKey() )
import ${ENTITY_PKG}.jpa.${entity.name}EntityKey;
#end
#foreach( $import in $java.imports($entity) )
import $import;
#end
import ${ROOT_PKG}.business.service.${entity.name}Service;
import ${ROOT_PKG}.business.service.mapping.${entity.name}ServiceMapper;
import ${ROOT_PKG}.persistence.PersistenceServiceProvider;
import ${ROOT_PKG}.persistence.services.${entity.name}Persistence;
import org.springframework.stereotype.Component;

/**
 * Implementation of ${entity.name}Service
 */
@Component
public class ${entity.name}ServiceImpl implements ${entity.name}Service {

	private ${entity.name}Persistence ${fn.uncapitalize($entity.name)}Persistence;

	@Resource
	private ${entity.name}ServiceMapper ${fn.uncapitalize($entity.name)}ServiceMapper;
	
	public ${entity.name}ServiceImpl() {
		${fn.uncapitalize($entity.name)}Persistence = PersistenceServiceProvider.getService(${entity.name}Persistence.class);
	}
		
	@Override
	public ${entity.name} findById($fn.argumentsListWithType($entity.keyAttributes)) {
		${entity.name}Entity entity = ${fn.uncapitalize($entity.name)}Persistence.load($fn.argumentsList($entity.keyAttributes));
		return ${fn.uncapitalize($entity.name)}ServiceMapper.map${entity.name}EntityTo${entity.name}(entity);
	}

	@Override
	public List<${entity.name}> findAll() {
		List<${entity.name}Entity> entities = ${fn.uncapitalize($entity.name)}Persistence.loadAll();
		List<${entity.name}> beans = new ArrayList<${entity.name}>();
		for(${entity.name}Entity entity : entities) {
			beans.add(${fn.uncapitalize($entity.name)}ServiceMapper.map${entity.name}EntityTo${entity.name}(entity));
		}
		return beans;
	}

	@Override
	public ${entity.name} save(${entity.name} ${fn.uncapitalize($entity.name)}) {
		return update(${fn.uncapitalize($entity.name)}) ;
	}

	@Override
	public ${entity.name} create(${entity.name} ${fn.uncapitalize($entity.name)}) {
		if(${fn.uncapitalize($entity.name)}Persistence.load($fn.argumentsListWithGetter(${fn.uncapitalize($entity.name)},$entity.keyAttributes)) != null) {
			throw new IllegalStateException("already.exists");
		}
		${entity.name}Entity ${fn.uncapitalize($entity.name)}Entity = new ${entity.name}Entity();
		${fn.uncapitalize($entity.name)}ServiceMapper.map${entity.name}To${entity.name}Entity(${fn.uncapitalize($entity.name)}, ${fn.uncapitalize($entity.name)}Entity);
		${entity.name}Entity ${fn.uncapitalize($entity.name)}EntitySaved = ${fn.uncapitalize($entity.name)}Persistence.save(${fn.uncapitalize($entity.name)}Entity);
		return ${fn.uncapitalize($entity.name)}ServiceMapper.map${entity.name}EntityTo${entity.name}(${fn.uncapitalize($entity.name)}EntitySaved);
	}

	@Override
	public ${entity.name} update(${entity.name} ${fn.uncapitalize($entity.name)}) {
		${entity.name}Entity ${fn.uncapitalize($entity.name)}Entity = ${fn.uncapitalize($entity.name)}Persistence.load($fn.argumentsListWithGetter(${fn.uncapitalize($entity.name)},$entity.keyAttributes));
		${fn.uncapitalize($entity.name)}ServiceMapper.map${entity.name}To${entity.name}Entity(${fn.uncapitalize($entity.name)}, ${fn.uncapitalize($entity.name)}Entity);
		${entity.name}Entity ${fn.uncapitalize($entity.name)}EntitySaved = ${fn.uncapitalize($entity.name)}Persistence.save(${fn.uncapitalize($entity.name)}Entity);
		return ${fn.uncapitalize($entity.name)}ServiceMapper.map${entity.name}EntityTo${entity.name}(${fn.uncapitalize($entity.name)}EntitySaved);
	}

	@Override
	public void delete($fn.argumentsListWithType($entity.keyAttributes)) {
		${fn.uncapitalize($entity.name)}Persistence.delete($fn.argumentsList($entity.keyAttributes));
	}

	public ${entity.name}Persistence get${entity.name}Persistence() {
		return ${fn.uncapitalize($entity.name)}Persistence;
	}

	public void set${entity.name}Persistence(${entity.name}Persistence ${fn.uncapitalize($entity.name)}Persistence) {
		this.${fn.uncapitalize($entity.name)}Persistence = ${fn.uncapitalize($entity.name)}Persistence;
	}

	public ${entity.name}ServiceMapper get${entity.name}ServiceMapper() {
		return ${fn.uncapitalize($entity.name)}ServiceMapper;
	}

	public void set${entity.name}ServiceMapper(${entity.name}ServiceMapper ${fn.uncapitalize($entity.name)}ServiceMapper) {
		this.${fn.uncapitalize($entity.name)}ServiceMapper = ${fn.uncapitalize($entity.name)}ServiceMapper;
	}

}
